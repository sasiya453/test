<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Obscura Vault - Courses</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="selenix.css">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <!-- Icons for the new player controls -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    .player-wrap { 
      max-width: 1100px; 
      margin: 0 auto; 
      padding: 0 15px;
    }

    .player-shell {
      position: relative;
      width: 100%;
      background: #000;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
      aspect-ratio: 16/9;
      user-select: none;
      -webkit-user-select: none;
    }

    /* Watermarks */
    .ov-watermark1 {
      position: absolute;
      bottom: 10px;
      right: 10px;
      pointer-events: none;
      opacity: 0.18;
      mix-blend-mode: difference;
      width: 100px;
      height: 100px;
      overflow: hidden;
      z-index: 3;
    }
    .ov-watermark1 img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: invert(1);
      opacity: 0.6;
    }
    .ov-watermark {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: grid;
      place-items: center;
      opacity: .18;
      mix-blend-mode: darken;
      font-weight: 700;
      color: #00f;
      text-transform: uppercase;
      letter-spacing: 4px;
      font-size: clamp(16px, 5vw, 42px);
      background-image:
        repeating-linear-gradient(
          -30deg,
          rgba(0,0,255,.12) 0 40px,
          rgba(0,0,255,.15) 40px 80px
        );
      z-index: 3;
    }
    .ov-watermark span { text-shadow: 0 1px 0 rgba(0,0,0,.8); }

    /* New player styles (scoped inside player-shell) */
    .player-shell .video-container {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      margin: 0;
      background: #000;
    }
    .player-shell #video-thumbnail {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      cursor: pointer;
    }
    .player-shell video,
    .player-shell img {
      width: 100%;
      height: 100%;
    }

    .player-shell .controls {
      position: absolute;
      left: 0;
      right: 0;
      bottom: env(safe-area-inset-bottom, 0);
      height: 40px;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      padding-left: calc(10px + env(safe-area-inset-left));
      padding-right: calc(10px + env(safe-area-inset-right));
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      z-index: 5; /* above watermarks */
    }
    .player-shell .controls button,
    .player-shell .controls input {
      background: transparent;
      border: none;
      cursor: pointer;
      color: #fff;
      font-size: 20px;
      outline: none;
    }
    .player-shell .left {
      width: 70px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .player-shell .right {
      padding: 10px;
      display: flex;
      align-items: center;
    }
    .player-shell .video-timer {
      position: relative;
      top: 5.2px;
      right: 6px;
      display: flex;
      flex-direction: row;
      color: #efefef;
      margin-left: 15px;
      font-size: 12px;
    }
    .player-shell #separator {
      margin: 0 5px;
      font-size: 16px;
      font-family: "Open sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .player-shell .fa-volume-up,
    .player-shell .fa-solid {
      font-size: small;
      padding: 5px;
      color: #fff;
    }
    .player-shell .volume-container {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .player-shell #volume {
      width: 60px;
      height: 3px;
    }
    .player-shell .playback-line {
      position: relative;
      top: 2.7px;
      height: 4px;
      background-color: #ddd;
      width: 40%;
      cursor: pointer;
    }
    .player-shell .progress-bar {
      height: 100%;
      width: 0;
      background-color: #0078d4;
      transition: width 0.1s linear;
    }

    /* Mobile: make controls visible in fullscreen/fill-viewport */
    @media (max-width: 768px) {
      .player-shell:fullscreen .controls,
      .player-shell:-webkit-full-screen .controls,
      .player-shell.fill-viewport .controls {
        opacity: 1 !important;
        pointer-events: auto !important;
      }
    }

    /* Fullscreen styles */
    .player-shell:fullscreen,
    .player-shell:-webkit-full-screen,
    .player-shell:-moz-full-screen,
    .player-shell:-ms-fullscreen {
      width: 100%;
      height: 100%;
      border-radius: 0;
      max-width: none;
    }

    /* Prevent dragging */
    img, .player-shell { -webkit-user-drag: none; }

    /* Auto-rotate: fill viewport in landscape on phones */
    @media (max-width: 768px) and (orientation: landscape) {
      body { overflow: hidden; }
      .header, .footer, .back-row, .player-cta, .bar, h3, #relatedCards {
        display: none !important;
      }
    }
    .player-shell.fill-viewport {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;    /* fallback */
      height: 100dvh;   /* modern browsers */
      border-radius: 0;
      max-width: none;
      z-index: 9999;
      aspect-ratio: auto;
    }
  </style>
</head>
<body class="no-js">
  <!-- No JavaScript warning -->
  <div class="no-js-message">
    <h2>JavaScript Required</h2>
    <p>This page requires JavaScript to function properly. Please enable JavaScript in your browser settings.</p>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container nav">
      <a class="brand" href="index.html">
        <img alt="selenix logo">
        <div class="logo-text">Obscura Vault</div>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#about">About</a>
        <a href="lessons.html">Lessons</a>
        <a href="index.html#contact">Contact</a>
        <button class="icon-btn" data-open-search aria-label="Search">
          <img class="search-icon" src="https://cdn-icons-png.flaticon.com/128/3686/3686896.png" alt="Search" loading="lazy" decoding="async">
        </button>
      </nav>
      <button class="icon-btn hamburger" aria-label="Menu"><span></span><span></span><span></span></button>
    </div>
    <div class="mobile-drawer">
      <a href="index.html">Home</a>
      <a href="index.html#about">About</a>
      <a href="lessons.html">Lessons</a>
      <a href="index.html#contact">Contact</a>
      <a href="#" data-open-search>Search</a>
    </div>
    <div class="mobile-searchbar">
      <form id="mobileSearchForm">
        <input id="mobileSearch" placeholder="Search lessons...">
        <button type="submit">Search</button>
      </form>
    </div>
  </header>

  <!-- Search overlay -->
  <div class="search-overlay" id="searchOverlay">
    <div class="search-card">
      <h3>Search lessons</h3>
      <div class="search-row">
        <input id="globalSearchInput" placeholder="Type keyword...">
        <button id="globalSearchGo">Search</button>
      </div>
    </div>
  </div>

  <div class="container player-wrap">
    <div class="back-row">
      <button data-back>← Back</button>
    </div>

    <h2 id="playerTitle">Loading...</h2>

    <!-- Player Shell -->
    <div class="player-shell" id="playerShell" aria-label="video player">
      <!-- New custom player inside shell -->
      <div class="video-container" id="videoContainer">
        <img src="https://media.geeksforgeeks.org/wp-content/uploads/20231020170918/Thumbnail-(1).jpg"
             id="video-thumbnail" alt="Video thumbnail">
        <video id="video" playsinline webkit-playsinline>
          <source id="videoSource"
                  src="https://media.geeksforgeeks.org/wp-content/uploads/20231020155223/Full-Stack-Development-_-LIVE-Classes-_-GeeksforGeeks.mp4"
                  type="video/mp4">
        </video>

        <!-- Controls -->
        <div class="controls" id="controls">
          <div class="left">
            <button id="skipminus-10" aria-label="Back 5s">
              <i class="fa-solid fa-backward"></i>
            </button>
            <button id="play-pause" aria-label="Play/Pause">
              <i class="fa-solid fa-play"></i>
            </button>
            <button id="skip-10" aria-label="Forward 5s">
              <i class="fa-solid fa-forward"></i>
            </button>
          </div>

          <div class="video-timer">
            <span id="current-time">00:00</span>
            <span id="separator">/</span>
            <span id="max-duration">00:00</span>
          </div>
          <div class="playback-line">
            <div class="progress-bar"></div>
          </div>

          <div class="right">
            <div class="volume-container">
              <div id="mute" aria-label="Mute/Unmute">
                <i class="fas fa-volume-up"></i>
              </div>
              <input type="range" id="volume" min="0" max="1" step="0.01" value="1" aria-label="Volume">
            </div>
          </div>
        </div>
      </div>

      <!-- Watermarks -->
      <div class="ov-watermark" aria-hidden="true"><span>Obscura Vault</span></div>
      <div class="ov-watermark1">
        <img src="http://lumosbio.infy.uk/wp-content/uploads/2025/08/Imaf.png" alt="Watermark">
      </div>
    </div>

    <div class="player-cta" style="margin-top:10px">
      <a class="btn1" id="telegramBtn" target="_blank">Terms and Conditions</a>
      <a class="btn1 secondary" id="resourceBtn" target="_blank">Access PDF</a>
    </div>

    <div class="bar" style="margin:20px 0 16px"></div>
    <h3>Other parts in this lesson</h3>
    <div class="cards" id="relatedCards"></div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-top-art"></div>
    <div class="container">
      <div class="footer-inner" style="grid-column:1/-1;display:flex;flex-direction:column;align-items:center;text-align:center;gap:18px;padding-top:10px;padding-bottom:50px">
        <div class="footer-social" style="display:flex;gap:18px">
          <a href="https://t.me/ObscuraVaulfOfficial" target="_blank" aria-label="Telegram" title="Telegram"
             style="width:44px;height:44px;border-radius:50%;background:#fff;color:#111;display:inline-flex;align-items:center;justify-content:center;font-size:26px;text-decoration:none">
            <i class='bx bxl-telegram'></i>
          </a>
          <a href="https://www.youtube.com/@ObscuraVault-Official" target="_blank" aria-label="YouTube" title="YouTube"
             style="width:44px;height:44px;border-radius:50%;background:#fff;color:#111;display:inline-flex;align-items:center;justify-content:center;font-size:26px;text-decoration:none">
            <i class='bx bxl-youtube'></i>
          </a>
        </div>
        <nav class="footer-menu" style="display:flex;gap:26px;flex-wrap:wrap;justify-content:center">
          <a href="index.html" style="color:#eaeaea;text-decoration:none">Home</a>
          <a href="index.html#about" style="color:#eaeaea;text-decoration:none">About</a>
          <a href="lessons.html" style="color:#eaeaea;text-decoration:none">Lessons</a>
          <a href="index.html#contact" style="color:#eaeaea;text-decoration:none">Contact</a>
        </nav>
        <div class="footer-copy" style="font-size:13px;color:#bdbdbd">© 2025 Obscura Vault. All Rights Reserved</div>
      </div>
    </div>
  </footer>

  <!-- Shared helpers -->
  <script src="selenix.js"></script>

  <!-- Page script -->
  <script>
  // Remove no-js class if JavaScript is enabled
  document.body.classList.remove('no-js');

  // ---- Security Measures (as in your page) ----
  document.addEventListener('contextmenu', e => { e.preventDefault(); return false; });
  document.addEventListener('selectstart', e => { e.preventDefault(); return false; });
  document.addEventListener('dragstart', e => { e.preventDefault(); return false; });
  document.addEventListener('keydown', function(e) {
    if (e.key === 'F12') { e.preventDefault(); return false; }
    if (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key)) { e.preventDefault(); return false; }
    if (e.ctrlKey && e.key === 'u') { e.preventDefault(); return false; }
    if ((e.ctrlKey || e.metaKey) && ['s','u','p','o'].includes(e.key.toLowerCase())) { e.preventDefault(); return false; }
  });
  setInterval(function() {
    const widthThreshold = window.outerWidth - window.innerWidth > 160;
    const heightThreshold = window.outerHeight - window.innerHeight > 160;
    if (!(heightThreshold && widthThreshold) &&
        ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) ||
         widthThreshold || heightThreshold)) {
      document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>Developer Tools Detected</h2><p>Please close developer tools to continue using this site.</p></div>';
      window.stop();
    }
  }, 1000);

  // ---- State (kept for sheet + related list) ----
  const state = { items:[], current:null, group:null, subjects:[], colors:{} };

  // Helpers
  function getRID(){ return new URLSearchParams(location.search).get('rid'); }

  // Render page (title, buttons, related)
  function renderPlayer(){
    const t = document.getElementById('playerTitle');
    if (!state.current){ t.textContent='Not found'; return; }
    t.textContent = `${state.current.lesson} — ${state.current.partTitle}`;

    const tg = document.getElementById('telegramBtn');
    const rs = document.getElementById('resourceBtn');
    tg.href = state.current.telegram || '#';
    rs.href = state.current.resource || '#';

    const rel = document.getElementById('relatedCards');
    rel.innerHTML = '';
    if (state.group){
      state.group.parts.forEach(p=>{
        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img'); img.src = p.thumb || ''; img.alt = p.partTitle || 'thumbnail';
        card.appendChild(img);
        const body = document.createElement('div'); body.className='card-body';
        const tag = document.createElement('div'); tag.className='tag-row';
        const dot = document.createElement('span'); dot.className='dot'; dot.style.setProperty('--subject-color', state.colors[state.group.subject]||'#000');
        tag.appendChild(dot);
        tag.appendChild(document.createTextNode(`${state.group.subject}`));
        const h4 = document.createElement('h4'); h4.textContent = p.partTitle || '';
        const desc = document.createElement('p'); desc.textContent = p.description || '';
        const actions = document.createElement('div'); actions.className='card-actions';
        const open = document.createElement('button'); open.className='btn1'; open.textContent = (p.id === state.current.id) ? 'Now Playing' : 'Play';
        open.disabled = (p.id === state.current.id);
        open.addEventListener('click', ()=>window.location.href=`player.html?rid=${encodeURIComponent(p.id)}`);
        actions.appendChild(open);
        body.appendChild(tag); body.appendChild(h4); body.appendChild(desc); body.appendChild(actions);
        card.appendChild(body);
        rel.appendChild(card);
      });
    }
  }

  // Choose a video source (prefers direct mp4-like links; falls back to default)
  function pickVideoSrc(item){
    const cand = [item?.resource, item?.telegram, item?.youtube].map(x => (x||'').trim()).filter(Boolean);
    const direct = cand.find(u => /\.(mp4|webm|mov)(\?|#|$)/i.test(u));
    return direct || 'https://media.geeksforgeeks.org/wp-content/uploads/20231020155223/Full-Stack-Development-_-LIVE-Classes-_-GeeksforGeeks.mp4';
  }

  // Auto-rotate handling (phones)
  function isPhone(){ return Math.min(window.innerWidth, window.innerHeight) <= 768; }
  function updateOrientationUI() {
    const shell = document.getElementById('playerShell');
    if (!shell) return;
    const landscape = window.matchMedia('(orientation: landscape)').matches;
    if (document.fullscreenElement) {
      shell.classList.remove('fill-viewport');
      return;
    }
    if (isPhone() && landscape) {
      shell.classList.add('fill-viewport');
    } else {
      shell.classList.remove('fill-viewport');
    }
  }
  ['resize','orientationchange'].forEach(ev=>window.addEventListener(ev, updateOrientationUI, {passive:true}));
  if (screen.orientation && screen.orientation.addEventListener) {
    screen.orientation.addEventListener('change', updateOrientationUI);
  }
  document.addEventListener('fullscreenchange', updateOrientationUI);

  // Boot
  async function boot(){
    selenix.initHeader();
    document.querySelector('[data-back]').addEventListener('click', () => {
      window.history.back();
    });

    try {
      state.items = await selenix.fetchSheet();
      state.subjects = selenix.uniqueSubjects(state.items);
      state.colors = selenix.subjectColorMap(state.subjects);
      const rid = getRID();
      state.current = state.items.find(x=>x.id===rid);
      if (state.current){
        const groups = selenix.groupByLesson(state.items);
        state.group = groups.find(g=>g.subject===state.current.subject && g.lesson===state.current.lesson);
      }
      renderPlayer();
      updateOrientationUI();

      // Set video source & thumbnail
      const video = document.getElementById('video');
      const source = document.getElementById('videoSource');
      const thumb = document.getElementById('video-thumbnail');
      const chosen = pickVideoSrc(state.current);
      source.src = chosen;
      if (state.current?.thumb) thumb.src = state.current.thumb;
      video.load();

      // Show controls briefly on init
      const controls = document.getElementById('controls');
      controls.style.opacity = 1;
      setTimeout(()=>{ controls.style.opacity = 0; }, 2000);

    } catch (e){
      console.error(e);
      document.getElementById('playerTitle').textContent = 'Failed to load player.';
    }
  }

  // ===== Your custom player JS (unaltered functions) =====

  // Select the elements
  const video = document.getElementById("video");
  const videoThumbnail = document.getElementById("video-thumbnail");
  const playpause = document.getElementById("play-pause");
  const frwd = document.getElementById("skip-10");
  const bkwrd = document.getElementById("skipminus-10");
  const volume = document.getElementById("volume");
  const mutebtn = document.getElementById("mute");
  const videoContainer = document.getElementById("videoContainer");
  const controls = document.getElementById("controls");
  const progressBar = document.querySelector(".progress-bar");
  const playbackline = document.querySelector(".playback-line");
  const currentTimeRef = document.getElementById("current-time");
  const maxDuration = document.getElementById("max-duration");

  const timeFormatter = (timeInput) => {
      let minute = Math.floor(timeInput / 60);
      minute = minute < 10 ? "0" + minute : minute;
      let second = Math.floor(timeInput % 60);
      second = second < 10 ? "0" + second : second;
      return `${minute}:${second}`;
  };

  // Play-Pause
  playpause.addEventListener("click", function () {
      if (video.paused) {
          videoThumbnail.style.display = "none";
          video.play();
          playpause.innerHTML = '<i class="fa-solid fa-pause"></i>';
      } else {
          video.pause();
          playpause.innerHTML = '<i class="fa-solid fa-play"></i>';
      }
  });

  let isPlaying = false;

  // Function to toggle play/pause
  function togglePlayPause() {
      if (isPlaying) {
          video.pause();
          playpause.innerHTML = '<i class="fa-solid fa-play"></i>';
      } else {
          videoThumbnail.style.display = "none";
          video.play();
          playpause.innerHTML = '<i class="fa-solid fa-pause"></i>';
      }
      isPlaying = !isPlaying;
  }

  document.addEventListener("keydown", function (event) {
      if (event.key === 32 || event.key === " ") {
          event.preventDefault();
          togglePlayPause();
      }
  });

  // Event listener for the video to update the isPlaying flag
  video.addEventListener("play", function () {
      isPlaying = true;
  });

  video.addEventListener("pause", function () {
      isPlaying = false;
  });

  video.addEventListener("ended", function () {
      playpause.innerHTML = '<i class="fa-solid fa-play"></i>';
  });

  // Forward 5 sec or backward 5 sec
  frwd.addEventListener("click", function () {
      video.currentTime += 5;
  });
  bkwrd.addEventListener("click", function () {
      video.currentTime -= 5;
  });

  // Mute or Unmute
  mutebtn.addEventListener("click", function () {
      if (video.muted) {
          video.muted = false;
          mutebtn.innerHTML = '<i class="fas fa-volume-up"></i>';
          volume.value = video.volume;
      } else {
          video.muted = true;
          mutebtn.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
          volume.value = 0;
      }
  });

  document.addEventListener("keydown", function (event) {
      if (event.key === "M" || event.key === "m") {
          event.preventDefault();
          if (video.muted) {
              video.muted = false;
              mutebtn.innerHTML = '<i class="fas fa-volume-up"></i>';
              volume.value = video.volume;
          } else {
              video.muted = true;
              mutebtn.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
              volume.value = 0;
          }
      }
  });

  volume.addEventListener("input", function () {
      video.volume = volume.value;
      if (video.volume === 0) {
          mutebtn.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
      } else {
          mutebtn.innerHTML = '<i class="fas fa-volume-up"></i>';
      }
  });

  // Hide or unhide controllers div (mouse)
  videoContainer.addEventListener("mouseenter", () => {
      controls.style.opacity = 1;
  });
  videoContainer.addEventListener("mouseleave", () => {
      controls.style.opacity = 0;
  });

  // Update the playback line as the video plays
  video.addEventListener("timeupdate", () => {
      const currentTime = video.currentTime;
      const duration = video.duration || 0;
      const percentage = duration ? (currentTime / duration) * 100 : 0;
      progressBar.style.width = percentage + "%";
  });

  function showThumbnail() {
      videoThumbnail.style.display = "block";
  }

  // Resetting the playback line when the video ends
  video.addEventListener("ended", () => {
      progressBar.style.width = "0%";
      showThumbnail();
  });

  setInterval(() => {
      currentTimeRef.innerHTML = timeFormatter(video.currentTime || 0);
      maxDuration.innerText = timeFormatter(video.duration || 0);
  }, 250);

  playbackline.addEventListener("click", (e) => {
      let timelineWidth = playbackline.clientWidth;
      video.currentTime = (e.offsetX / timelineWidth) * (video.duration || 0);
  });

  // Extra: ensure max duration updates once metadata loads
  video.addEventListener('loadedmetadata', () => {
    if (!isNaN(video.duration)) {
      maxDuration.innerText = timeFormatter(video.duration);
    }
  });

  // Mobile: tap to show controls briefly
  (function () {
    function showControlsTemporarily(ms = 3000) {
      controls.style.opacity = 1;
      const shell = document.getElementById('playerShell');
      const inFill = shell.classList.contains('fill-viewport');
      const inFS = !!document.fullscreenElement;
      if (inFill || inFS) return; // keep visible in these modes
      clearTimeout(window._ctrlsTimer);
      window._ctrlsTimer = setTimeout(() => { controls.style.opacity = 0; }, ms);
    }
    ["touchstart","click"].forEach(ev=>{
      videoContainer.addEventListener(ev, ()=>showControlsTemporarily(), {passive:true});
    });
    window.addEventListener('orientationchange', ()=>showControlsTemporarily(3500));
  })();

  // Start the page
  boot();
  </script>
</body>
</html>
